<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chartroom</title>
</head>
<body>
    <textarea id="txtShow" disabled></textarea>
    <input id="txtInput" type="text">
    <button id="btnSend" onclick="sendMessage()">送出</button>
</body>
<script>
  // 建立 WebSocket (本例 server 端於本地運行)
  let url = `ws://localhost:5500`
  let webSocket = new WebSocket(url);

  let keyinElem = document.querySelector('#txtInput');
  let showElem = document.querySelector('#txtShow');

  initWebSocket();
  getMessage();

  function initWebSocket() {
    // 監聽連線狀態
    webSocket.onopen = () => {
      console.log('open connection')
    }

    webSocket.onclose = () => {
      console.log('close connection');
    }
  }

  //接收 Server 發送的訊息
  function getMessage() {
    webSocket.onmessage = event => {
      let txt = event.data
      if (!showElem.value) showElem.value = txt
      else showElem.value = showElem.value + "\n" + txt
      keyinElem.value = ""
    }
  }

  function sendMessage() {
    let txt = keyinElem.value;
    console.log(webSocket)
    webSocket.send(txt);
  }

  function onButtonClick(event) {
    let txt = keyinElem.value;
      webSocket.send(txt);
  }
</script>
</html>